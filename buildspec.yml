version: 0.2

env:
  parameter-store:
    bucket: "deploy-lambda-example-bucket"

phases:
  install:
    commands:
      - make dep
      - aws ssm get-parameter --name deploy-lambda-example-bucket --with-decryption --query "Parameter.{name:Name,value:Value}" --output text
      - echo $bucket
  build:
    commands:
      - make build
  post_build:
    commands:
      - aws cloudformation package --template-file template.yml --s3-bucket $bucket --output-template-file deploy.yml
artifacts:
  type: zip
  files:
    - template.yml
    - deploy.yml
